### 2.1 数据并行

当现代软件应用程序运行缓慢时，问题通常出在需要处理的数据量太大。图像处理应用程序处理具有数百万到万亿像素的图像或视频。科学应用程序使用数十亿个网格点来模拟流体动力学。分子动力学应用程序必须模拟数千到数十亿个原子之间的相互作用。航空公司调度涉及成千上万的航班、机组人员和机场登机口。这些像素、粒子、网格点、相互作用、航班等中的大多数通常可以独立处理。例如，在图像处理过程中，将彩色像素转换为灰度仅需要该像素的数据。模糊图像通过将每个像素的颜色与附近像素的颜色平均化，仅需要该小范围像素邻域的数据。即使是看似全局的操作，例如查找图像中所有像素的平均亮度，也可以分解为许多可以独立执行的较小计算。这种对不同数据块的独立评估是数据并行性(data parallelism)的基础。编写数据并行代码意味着围绕数据重新组织计算流程，使得我们可以并行执行结果独立的计算过程，以更快（通常快得多）地完成整体任务。

让我们通过一个颜色转换为灰度的示例来说明数据并行的概念。[图2.1](#fig2.1)展示了一张彩色图像（左侧），该图像由许多像素组成，每个像素包含一个红色、绿色和蓝色的分数值（r, g, b），这些值从0（黑色）到1（全强度）不等。

为了将彩色图像（[图2.1](#fig2.1)的左侧）转换为灰度图像（右侧），我们通过应用以下加权求和公式计算每个像素的亮度值L：
$$
L = r * 0.21 + g * 0.72 + b * 0.07
$$

<figure>
    <style>
     hr {
         border: none;
         height: 2px;
         background-color: black;
         margin: 5px auto;
     }
	</style>
    <img id="fig2.1" src="..\pic\chapter2\fig2.1.jpeg">
    <figcaption>
        <p class="no-indent" style="font-weight: bold;">
        图2.1
        </p>
       	<hr style="border: none; height: 2px; background-color: black; margin: 5px auto;">
        <p class="no-indent" style="font-family: 'Arial', 'Helvetica', sans-serif;color: #808080">
            将彩色图像转换为灰度图像。
        </p>
    </figcaption>
</figure>
> ### RGB彩色图像表示
>
> 在RGB表示中，图像中的每个像素存储为(r, g, b)值的元组。图像行的格式为(r g b) (r g b) … (r g b)，如以下概念图所示。每个元组指定了红色(R)、绿色(G)和蓝色(B)的混合。这意味着，对于每个像素，r、g和b值分别表示红色、绿色和蓝色光源在渲染像素时的强度（0表示暗，1表示全强度）。
>
> <img id="rgb" src="..\pic\chapter2\rgb.jpeg" alt="图1.1">
>
> 这三种颜色的实际允许混合在不同行业内指定的颜色空间中有所不同。在此，AdobeRGB颜色空间中三种颜色的有效组合显示为三角形的内部。每种混合的垂直坐标（y值）和水平坐标（x值）表示像素强度中应分配给绿色和红色的比例。像素强度的剩余部分（1-y-x）应分配给蓝色。为了渲染图像，每个像素的r、g、b值用于计算像素的总强度（亮度）以及混合系数（x, y, 1-y-x）。
